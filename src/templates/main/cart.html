{% extends 'base.html' %}
{% load static %}
{% load currency_tags %}

{% block title %}Your Cart{% endblock %}

{% block content %}
<section class="ftco-section" style="padding-top: 100px; min-height: 60vh;">
  <div class="container">
    <h3 class="title">Shopping Cart</h3>

    {% if cart_items %}
      <div class="card">
        <div class="card-body">
          <table class="table" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr>
                <th style="text-align:left; padding:8px">Product</th>
                <th style="text-align:right; padding:8px">Price</th>
                <th style="text-align:center; padding:8px">Quantity</th>
                <th style="text-align:right; padding:8px">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              {% for item in cart_items %}
                <tr>
                  <td style="padding:8px; vertical-align:middle;">
                    <div style="display:flex; gap:10px; align-items:center;">
                      {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width:64px;height:64px;object-fit:cover;border-radius:6px;" />
                      {% endif %}
                      <div>
                        <strong>{{ item.product.name }}</strong>
                        <div class="small text-muted">
                          {% if item.product.category %}{{ item.product.category.name }}{% endif %}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td style="text-align:right; padding:8px;">{% format_price item.product.price %}</td>
                  <td style="text-align:center; padding:8px;">
                    <form method="POST" action="{% url 'update_cart' item.product.id %}" style="display:inline; margin:0;">
                      {% csrf_token %}
                      <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.stock }}" style="width:60px; padding:4px;">
                      <button type="submit" class="btn btn-sm btn-info" style="padding:2px 8px;">Update</button>
                    </form>
                  </td>
                  <td style="text-align:right; padding:8px;">
                    {% format_price item.subtotal %}
                    <br>
                    <a href="{% url 'remove_from_cart' item.product.id %}" class="btn btn-sm btn-danger" style="margin-top:4px;">Remove</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3" style="text-align:right; padding:8px;"><strong>Total:</strong></td>
                <td style="text-align:right; padding:8px;"><strong>{% format_price cart_total %}</strong></td>
              </tr>
            </tfoot>
          </table>

          <div style="margin-top:16px; display:flex; gap:12px; justify-content:space-between; flex-wrap:wrap;">
            <div>
              <a href="{% url 'home' %}" class="btn btn-secondary" style="background:#f5f5f5; border:1px solid #e6e6e6; color:#333;">Continue Shopping</a>
              <a href="{% url 'clear_cart' %}" class="btn btn-danger" style="margin-left:8px;" onclick="return confirm('Are you sure you want to clear your cart?');">Clear Cart</a>
            </div>
            <div>
              <a href="{% url 'checkout' %}" class="btn btn-primary">Proceed to Checkout</a>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="card">
        <div class="card-body">
          <p>Your cart is empty.</p>
          <a href="{% url 'home' %}" class="btn btn-primary">Shop Now</a>
        </div>
      </div>
    {% endif %}

  </div>
</section>
{% endblock %}